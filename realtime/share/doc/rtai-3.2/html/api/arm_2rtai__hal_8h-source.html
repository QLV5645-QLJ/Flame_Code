<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: base/include/asm-arm/rtai_hal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">base</a>&nbsp;/&nbsp;<a class="el" href="dir_000014.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000015.html">asm-arm</a></div>
<h1>rtai_hal.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * ARTI -- RTAI-compatible Adeos-based Real-Time Interface.</span>
00003 <span class="comment"> *         Based on ARTI for x86 and RTHAL for ARM.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * Original RTAI/x86 layer implementation:</span>
00006 <span class="comment"> *   Copyright (c) 2000 Paolo Mantegazza (mantegazza@aero.polimi.it)</span>
00007 <span class="comment"> *   Copyright (c) 2000 Steve Papacharalambous (stevep@zentropix.com)</span>
00008 <span class="comment"> *   Copyright (c) 2000 Stuart Hughes</span>
00009 <span class="comment"> *   and others.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * RTAI/x86 rewrite over Adeos:</span>
00012 <span class="comment"> *   Copyright (c) 2002 Philippe Gerum (rpm@xenomai.org)</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * Original RTAI/ARM RTHAL implementation:</span>
00015 <span class="comment"> *   Copyright (c) 2000 Pierre Cloutier (pcloutier@poseidoncontrols.com)</span>
00016 <span class="comment"> *   Copyright (c) 2001 Alex Züpke, SYSGO RTS GmbH (azu@sysgo.de)</span>
00017 <span class="comment"> *   Copyright (c) 2002 Guennadi Liakhovetski DSA GmbH (gl@dsa-ac.de)</span>
00018 <span class="comment"> *   Copyright (c) 2002 Steve Papacharalambous (stevep@zentropix.com)</span>
00019 <span class="comment"> *   Copyright (c) 2002 Wolfgang Müller (wolfgang.mueller@dsa-ac.de)</span>
00020 <span class="comment"> *   Copyright (c) 2003 Bernard Haible, Marconi Communications</span>
00021 <span class="comment"> *   Copyright (c) 2003 Thomas Gleixner (tglx@linutronix.de)</span>
00022 <span class="comment"> *   Copyright (c) 2003 Philippe Gerum (rpm@xenomai.org)</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> * RTAI/ARM over Adeos rewrite:</span>
00025 <span class="comment"> *   Copyright (c) 2004-2005 Michael Neuhauser, Firmix Software GmbH (mike@firmix.at)</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> * This program is free software; you can redistribute it and/or modify it under</span>
00029 <span class="comment"> * the terms of the GNU General Public License as published by the Free Software</span>
00030 <span class="comment"> * Foundation, Inc., 675 Mass Ave, Cambridge MA 02139, USA; either version 2 of</span>
00031 <span class="comment"> * the License, or (at your option) any later version.</span>
00032 <span class="comment"> *</span>
00033 <span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
00034 <span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
00035 <span class="comment"> * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more</span>
00036 <span class="comment"> * details.</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> * You should have received a copy of the GNU General Public License along with</span>
00039 <span class="comment"> * this program; if not, write to the Free Software Foundation, Inc., 59 Temple</span>
00040 <span class="comment"> * Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00041 <span class="comment"> */</span>
00042 <span class="preprocessor">#ifndef _RTAI_ASM_ARM_HAL_H</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_ASM_ARM_HAL_H</span>
00044 <span class="preprocessor"></span>
00045 <span class="preprocessor">#include &lt;rtai_types.h&gt;</span>
00046 <span class="preprocessor">#include &lt;asm/rtai_vectors.h&gt;</span>
00047 <span class="preprocessor">#include &lt;linux/bitops.h&gt;</span>
00048 <span class="preprocessor">#ifndef __KERNEL__</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#include &lt;strings.h&gt;</span>
00050 <span class="preprocessor">#endif</span>
00051 <span class="preprocessor"></span>
00052 <span class="comment">/* sanity checks */</span>
00053 <span class="preprocessor">#ifndef CONFIG_RTAI_ADEOS</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#error "Sorry, you have to use a Kernel patched with Adeos for ARM"</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_SMP</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#error "Sorry, SMP is not supported on ARM"</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00059 <span class="preprocessor"></span>
00060 <span class="preprocessor">#define RTAI_NR_CPUS    1</span>
00061 <span class="preprocessor"></span>
00062 <span class="comment">/* no, we don't have a 8254 to emulate TSC (sub-arch has to provide TSC stuff!) */</span>
00063 <span class="preprocessor">#undef DECLR_8254_TSC_EMULATION</span>
00064 <span class="preprocessor"></span>
00065 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
00066 ffnz(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> word)
00067 {
00068     <span class="keywordflow">return</span> ffs(word) - 1;
00069 }
00070 
00071 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>
00072 rtai_ulldiv(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ull,
00073             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> uld,
00074             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *r)
00075 {
00076     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> q = ull / uld;
00077     *r = ull - q * uld;
00078     <span class="keywordflow">return</span> q;
00079 }
00080 
00081 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>
00082 rtai_llimd(<span class="keywordtype">long</span> <span class="keywordtype">long</span> ll, <span class="keywordtype">int</span> mult, <span class="keywordtype">int</span> div)
00083 {
00084     <span class="keywordtype">long</span> <span class="keywordtype">long</span> q;
00085     <span class="keywordtype">int</span> r;
00086 
00087     <span class="keywordflow">if</span> (mult == div)
00088         <span class="keywordflow">return</span> ll;
00089 
00090     ll *= mult;
00091     q = ll / div;
00092     r = ll - q * div;
00093 
00094     <span class="keywordflow">return</span> (r + r) &lt; div ? q : q + 1;
00095 }
00096 
00097 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00098 rtai_imuldiv(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> mult, <span class="keywordtype">int</span> div)
00099 {
00100     <span class="keywordtype">long</span> <span class="keywordtype">long</span> ll = i;
00101     <span class="keywordtype">int</span> q;
00102     <span class="keywordtype">int</span> r;
00103 
00104     <span class="keywordflow">if</span> (mult == div)
00105         <span class="keywordflow">return</span> i;
00106 
00107     ll *= mult;
00108     q = ll / div;
00109     r = ll - (<span class="keywordtype">long</span> long)q * div;
00110 
00111     <span class="keywordflow">return</span> (r + r) &lt; div ? q : q + 1;
00112 }
00113 
00114 <span class="comment">/* get architecture specific things (using &lt;asm/...&gt; breaks</span>
00115 <span class="comment"> * build-in-seperate-directory feature!) */</span>
00116 <span class="preprocessor">#include &lt;asm-arm/arch/rtai_arch.h&gt;</span>
00117 
00118 <span class="preprocessor">#define RTAI_CPU_FREQ                   RTAI_TSC_FREQ</span>
00119 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_CALIBRATED_CPU_FREQ        RTAI_TSC_FREQ</span>
00120 <span class="preprocessor"></span>
00121 <span class="preprocessor">#if defined(__KERNEL__) &amp;&amp; !defined(__cplusplus)</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/sched.h&gt;</span>
00123 <span class="preprocessor">#include &lt;rtai_trace.h&gt;</span>
00124 <span class="preprocessor">#include &lt;asm/rtai_sched.h&gt;</span>
00125 <span class="preprocessor">#include &lt;asm/rtai_atomic.h&gt;</span>
00126 <span class="preprocessor">#include &lt;asm/rtai_fpu.h&gt;</span>
00127 
00128 <span class="preprocessor">#define RTAI_DOMAIN_ID                  0x52544149</span>
00129 <span class="preprocessor"></span><span class="preprocessor">#define RTAI_NR_SRQS                    32</span>
00130 <span class="preprocessor"></span>
00131 <span class="preprocessor">#define RTAI_TIME_LIMIT                 0x7FFFFFFFFFFFFFFFLL</span>
00132 <span class="preprocessor"></span>
00133 <span class="preprocessor">#define RTAI_IFLAG                      (7)</span>
00134 <span class="preprocessor"></span>
00135 <span class="preprocessor">#define rtai_cpuid()                    adeos_processor_id()</span>
00136 <span class="preprocessor"></span><span class="preprocessor">#define rtai_tskext(idx)                ptd[idx]</span>
00137 <span class="preprocessor"></span>
00138 <span class="comment">/* Use these in hard real time code to achieve UP-atomicity. */</span>
00139 <span class="preprocessor">#define rtai_cli()                      adeos_stall_pipeline_from(&amp;rtai_domain)</span>
00140 <span class="preprocessor"></span><span class="preprocessor">#define rtai_sti()                      adeos_unstall_pipeline_from(&amp;rtai_domain)</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define rtai_save_flags_and_cli(x)      ((x) = adeos_test_and_stall_pipeline_from(&amp;rtai_domain))</span>
00142 <span class="preprocessor"></span><span class="preprocessor">#define rtai_restore_flags(x)           adeos_restore_pipeline_from(&amp;rtai_domain,(x))</span>
00143 <span class="preprocessor"></span><span class="preprocessor">#define rtai_save_flags(x)              ((x) = adeos_test_pipeline_from(&amp;rtai_domain))</span>
00144 <span class="preprocessor"></span>
00145 <span class="comment">/* Use these when accessing the hardware. */</span>
00146 <span class="preprocessor">#define rtai_hw_disable()               adeos_hw_cli()</span>
00147 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_enable()                adeos_hw_sti()</span>
00148 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_lock(flags)             adeos_hw_local_irq_save(flags)</span>
00149 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_unlock(flags)           adeos_hw_local_irq_restore(flags)</span>
00150 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_flags(x)                adeos_hw_local_irq_flags(flags)</span>
00151 <span class="preprocessor"></span><span class="comment">/* alternative names */</span>
00152 <span class="preprocessor">#define rtai_hw_cli()                   rtai_hw_disable()</span>
00153 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_sti()                   rtai_hw_enable()</span>
00154 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_save_flags_and_cli(f)   rtai_hw_lock(f)</span>
00155 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_restore_flags(f)        rtai_hw_unlock(f)</span>
00156 <span class="preprocessor"></span><span class="preprocessor">#define rtai_hw_save_flags(f)           rtai_hw_flags(f)</span>
00157 <span class="preprocessor"></span>
00158 <span class="preprocessor">#define __adeos_pend_uncond(irq, cpuid) adeos_propagate_irq(irq)</span>
00159 <span class="preprocessor"></span>
00160 <span class="keyword">struct </span>calibration_data {
00161     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cpu_freq;             <span class="comment">/* TSC (i.e. rtai_rdtsc()) clock frequency, set in hal.c */</span>
00162     <span class="keywordtype">int</span> latency;                        <span class="comment">/* all other values are set by the scheduler, see there */</span>
00163     <span class="keywordtype">int</span> setup_time_TIMER_CPUNIT;
00164     <span class="keywordtype">int</span> setup_time_TIMER_UNIT;
00165     <span class="keywordtype">int</span> timers_tol[RTAI_NR_CPUS];
00166 };
00167 <span class="keyword">extern</span> <span class="keyword">struct </span>calibration_data          rtai_tunables;
00168 
00169 <span class="keyword">struct </span>rtai_switch_data {
00170     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> depth;
00171     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> oldflags;
00172 };
00173 
00174 <span class="comment">/* x86 legacy type (needed because some general code still uses x86 specific stuff) */</span>
00175 <span class="keyword">struct </span>apic_timer_setup_data {
00176     <span class="keywordtype">int</span> mode;
00177     <span class="keywordtype">int</span> count;
00178 };
00179 
00180 <span class="keyword">extern</span> <span class="keyword">struct </span>rt_times                  rt_times;
00181 <span class="keyword">extern</span> <span class="keyword">struct </span>rt_times                  rt_smp_times[RTAI_NR_CPUS];
00182 <span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           rtai_cpu_realtime;
00183 <span class="keyword">extern</span> <span class="keyword">struct </span>rtai_switch_data          rtai_linux_context[RTAI_NR_CPUS];
00184 <span class="keyword">extern</span> <span class="keywordtype">int</span>                              rtai_adeos_ptdbase;
00185 <span class="keyword">extern</span> adomain_t                        rtai_domain;
00186 
00187 <span class="comment">/* type of rt irq handler (general + timer) */</span>
00188 <span class="keyword">typedef</span> void (*rt_irq_handler_t)(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">void</span> *cookie);
00189 <span class="keyword">typedef</span> void (*rt_timer_irq_handler_t)(void);
00190 
00191 <span class="preprocessor">#ifdef CONFIG_ADEOS_THREADS</span>
00192 <span class="preprocessor"></span>
00193 <span class="comment">/* rtai_get_current() is Adeos-specific. Since real-time interrupt</span>
00194 <span class="comment">   handlers are called on behalf of the RTAI domain stack, we cannot</span>
00195 <span class="comment">   infere the "current" Linux task address using a CPU-register. We must use the</span>
00196 <span class="comment">   suspended Linux domain's stack pointer instead. */</span>
00197 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keyword">struct </span>task_struct *
00198 rtai_get_root_current(<span class="keywordtype">int</span> cpuid)
00199 {
00200 <span class="preprocessor">#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0)</span>
00201 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (<span class="keyword">struct</span> task_struct *)(((u_long)adp_root-&gt;esp[cpuid]) &amp; (~8191UL));
00202 <span class="preprocessor">#else </span><span class="comment">/* LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,0) */</span>
00203     <span class="keywordflow">return</span> ((<span class="keyword">struct</span> thread_info *)(((u_long)adp_root-&gt;esp[cpuid]) &amp; (~((THREAD_SIZE)-1))))-&gt;task;
00204 <span class="preprocessor">#endif </span><span class="comment">/* LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,0) */</span>
00205 }
00206 
00207 <span class="preprocessor">#else </span><span class="comment">/* !CONFIG_ADEOS_THREADS */</span>
00208 
00209 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keyword">struct </span>task_struct *
00210 rtai_get_root_current(<span class="keywordtype">int</span> cpuid)
00211 {
00212     <span class="keywordflow">return</span> current;
00213 }
00214 
00215 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_ADEOS_THREADS */</span>
00216 
00217 <span class="comment">/* following macros only valid for UP */</span>
00218 
00219 <span class="preprocessor">#ifndef CONFIG_SMP</span>
00220 <span class="preprocessor"></span>
00221 <span class="preprocessor">#define rt_spin_lock(lock)                      (void)(lock) </span><span class="comment">/* Not "unused variable". */</span>
00222 <span class="preprocessor">#define rt_spin_unlock(lock)                    do { </span><span class="comment">/* nop */</span> } while (0)
00223 <span class="preprocessor">#define rt_spin_lock_irq(lock)                  do { (void)(lock); rtai_cli(); } while (0)</span>
00224 <span class="preprocessor"></span><span class="preprocessor">#define rt_spin_unlock_irq(lock)                rtai_sti()</span>
00225 <span class="preprocessor"></span><span class="preprocessor">#define rt_spin_lock_irqsave(lock)              ({ unsigned long flags; (void)(lock); rtai_save_flags_and_cli(flags); flags; })</span>
00226 <span class="preprocessor"></span><span class="preprocessor">#define rt_spin_unlock_irqrestore(flags, lock)  rtai_restore_flags(flags)</span>
00227 <span class="preprocessor"></span>
00228 <span class="preprocessor">#define rt_get_global_lock()                    rtai_cli()</span>
00229 <span class="preprocessor"></span><span class="preprocessor">#define rt_release_global_lock()                do { </span><span class="comment">/* nop */</span> } while (0)
00230 
00231 <span class="preprocessor">#define rt_global_cli()                         rtai_cli()</span>
00232 <span class="preprocessor"></span><span class="preprocessor">#define rt_global_sti()                         rtai_sti()</span>
00233 <span class="preprocessor"></span><span class="preprocessor">#define rt_global_save_flags_and_cli()          ({ unsigned long flags; rtai_save_flags_and_cli(flags); flags; })</span>
00234 <span class="preprocessor"></span><span class="preprocessor">#define rt_global_restore_flags(flags)          rtai_restore_flags(flags)</span>
00235 <span class="preprocessor"></span><span class="preprocessor">#define rt_global_save_flags(flags)             rtai_save_flags(*flags)</span>
00236 <span class="preprocessor"></span>
00237 <span class="preprocessor">#endif </span><span class="comment">/* !CONFIG_SMP */</span>
00238 
00239 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
00240 rt_switch_to_real_time(<span class="keywordtype">int</span> cpuid)
00241 {
00242     ADEOS_PARANOIA_ASSERT(adeos_hw_irqs_disabled());
00243     TRACE_RTAI_SWITCHTO_RT(cpuid);
00244     <span class="keywordflow">if</span> (!rtai_linux_context[cpuid].depth++) {
00245         rtai_linux_context[cpuid].oldflags = adeos_test_and_stall_pipeline_from(adp_root);
00246         __set_bit(cpuid, &amp;rtai_cpu_realtime);
00247     } <span class="keywordflow">else</span> {
00248         ADEOS_PARANOIA_ASSERT(test_bit(IPIPE_STALL_FLAG, &amp;adp_root-&gt;cpudata[cpuid].status) != 0);
00249     }
00250 }
00251 
00252 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
00253 rt_switch_to_linux(<span class="keywordtype">int</span> cpuid)
00254 {
00255     ADEOS_PARANOIA_ASSERT(adeos_hw_irqs_disabled());
00256     TRACE_RTAI_SWITCHTO_LINUX(cpuid);
00257     <span class="keywordflow">if</span> (rtai_linux_context[cpuid].depth) {
00258         <span class="keywordflow">if</span> (!--rtai_linux_context[cpuid].depth) {
00259             __clear_bit(cpuid, &amp;rtai_cpu_realtime);
00260             adeos_restore_pipeline_nosync(adp_root, rtai_linux_context[cpuid].oldflags, cpuid);
00261         }
00262     }
00263 }
00264 
00265 <span class="preprocessor">#define in_hrt_mode(cpuid)  (test_bit(cpuid, &amp;rtai_cpu_realtime))</span>
00266 <span class="preprocessor"></span>
00267 <span class="comment">/* Private interface -- internal use only</span>
00268 <span class="comment"> * ====================================== */</span>
00269 
00270 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    rtai_critical_enter(<span class="keywordtype">void</span> (*synch)(<span class="keywordtype">void</span>));
00271 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rtai_critical_exit(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags);
00272 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rtai_set_linux_task_priority(<span class="keyword">struct</span> task_struct *task,
00273                                                      <span class="keywordtype">int</span> policy, <span class="keywordtype">int</span> prio);
00274 
00275 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ &amp;&amp; !__cplusplus */</span>
00276 
00277 <span class="comment">/* Public interface</span>
00278 <span class="comment"> * ================ */</span>
00279 
00280 <span class="preprocessor">#ifdef __KERNEL__</span>
00281 <span class="preprocessor"></span>
00282 <span class="preprocessor">#include &lt;linux/kernel.h&gt;</span>
00283 
00284 <span class="comment">/* printk is safe to use with Adeos */</span>
00285 <span class="preprocessor">#define rt_printk                       printk</span>
00286 <span class="preprocessor"></span><span class="preprocessor">#define rtai_print_to_screen            printk</span>
00287 <span class="preprocessor"></span>
00288 <span class="preprocessor">#ifdef __cplusplus</span>
00289 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00290 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00291 
00292 <span class="keyword">extern</span> <span class="keywordtype">int</span>              rt_request_irq(<span class="keywordtype">unsigned</span> irq, rt_irq_handler_t handler, <span class="keywordtype">void</span> *cookie, <span class="keywordtype">int</span> retmode);
00293 <span class="keyword">extern</span> <span class="keywordtype">int</span>              rt_release_irq(<span class="keywordtype">unsigned</span> irq);
00294 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rt_set_irq_cookie(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">void</span> *cookie);
00295 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span>         <a class="code" href="group__hal.html#ga85">rt_startup_irq</a>(<span class="keywordtype">unsigned</span> irq);
00296 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga86">rt_shutdown_irq</a>(<span class="keywordtype">unsigned</span> irq);
00297 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga87">rt_enable_irq</a>(<span class="keywordtype">unsigned</span> irq);
00298 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga88">rt_disable_irq</a>(<span class="keywordtype">unsigned</span> irq);
00299 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga89">rt_mask_and_ack_irq</a>(<span class="keywordtype">unsigned</span> irq);
00300 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga90">rt_unmask_irq</a>(<span class="keywordtype">unsigned</span> irq);
00301 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga91">rt_ack_irq</a>(<span class="keywordtype">unsigned</span> irq);
00302 <span class="keyword">extern</span> <span class="keywordtype">int</span>              <a class="code" href="group__hal.html#ga93">rt_request_linux_irq</a>(<span class="keywordtype">unsigned</span> irq,
00303                                              irqreturn_t (*handler)(<span class="keywordtype">int</span> irq, <span class="keywordtype">void</span> *dev_id,
00304                                                                     <span class="keyword">struct</span> pt_regs *regs),
00305                                              <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *dev_id);
00306 <span class="keyword">extern</span> <span class="keywordtype">int</span>              <a class="code" href="group__hal.html#ga94">rt_free_linux_irq</a>(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">void</span> *dev_id);
00307 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga95">rt_pend_linux_irq</a>(<span class="keywordtype">unsigned</span> irq);
00308 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga98">rt_pend_linux_srq</a>(<span class="keywordtype">unsigned</span> srq);
00309 <span class="keyword">extern</span> <span class="keywordtype">int</span>              <a class="code" href="group__hal.html#ga96">rt_request_srq</a>(<span class="keywordtype">unsigned</span> label, <span class="keywordtype">void</span> (*k_handler)(<span class="keywordtype">void</span>),
00310                                        <span class="keywordtype">long</span> <span class="keywordtype">long</span> (*u_handler)(<span class="keywordtype">unsigned</span>));
00311 <span class="keyword">extern</span> <span class="keywordtype">int</span>              <a class="code" href="group__hal.html#ga97">rt_free_srq</a>(<span class="keywordtype">unsigned</span> srq);
00312 <span class="keyword">extern</span> <span class="keywordtype">int</span>              rt_assign_irq_to_cpu(<span class="keywordtype">int</span> irq, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cpus_mask);
00313 <span class="keyword">extern</span> <span class="keywordtype">int</span>              rt_reset_irq_to_sym_mode(<span class="keywordtype">int</span> irq);
00314 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rt_request_timer_cpuid(rt_timer_irq_handler_t handler, <span class="keywordtype">unsigned</span> tick, <span class="keywordtype">int</span> cpuid);
00315 <span class="keyword">extern</span> <span class="keywordtype">int</span>              <a class="code" href="group__hal.html#ga104">rt_request_timer</a>(rt_timer_irq_handler_t handler, <span class="keywordtype">unsigned</span> tick, <span class="keywordtype">int</span> use_apic);
00316 <span class="keyword">extern</span> <span class="keywordtype">void</span>             <a class="code" href="group__hal.html#ga105">rt_free_timer</a>(<span class="keywordtype">void</span>);
00317 <span class="keyword">extern</span> RT_TRAP_HANDLER  rt_set_trap_handler(RT_TRAP_HANDLER handler);
00318 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rt_mount(<span class="keywordtype">void</span>);
00319 <span class="keyword">extern</span> <span class="keywordtype">void</span>             rt_umount(<span class="keywordtype">void</span>);
00320 <span class="keyword">extern</span> void             (*rt_set_ihook(<span class="keywordtype">void</span> (*hookfn)(<span class="keywordtype">int</span>)))(int);
00321 
00322 <span class="comment">/* deprecated calls */</span>
00323 
00324 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00325 rt_request_global_irq(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>))
00326 {
00327     <span class="comment">/* cast is okay because retmode is 0 (i.e. irq-handling doesn't use return</span>
00328 <span class="comment">     * value of handler, so it does not need to have one) */</span> 
00329     <span class="keywordflow">return</span> rt_request_irq(irq, (rt_irq_handler_t)handler, NULL, 0);
00330 }
00331 
00332 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00333 rt_request_global_irq_ext(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">void</span> (*handler)(<span class="keywordtype">void</span>), <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie)
00334 {
00335     <span class="comment">/* cast is okay because retmode is 0 (i.e. irq-handling doesn't use return</span>
00336 <span class="comment">     * value of handler, so it does not need to have one) */</span> 
00337     <span class="keywordflow">return</span> rt_request_irq(irq, (rt_irq_handler_t)handler, (<span class="keywordtype">void</span> *)cookie, 0);
00338 }
00339 
00340 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
00341 rt_set_global_irq_ext(<span class="keywordtype">unsigned</span> irq, <span class="keywordtype">int</span> ext, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cookie)
00342 {
00343     rt_set_irq_cookie(irq, (<span class="keywordtype">void</span> *)cookie);
00344 }
00345 
00346 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00347 rt_free_global_irq(<span class="keywordtype">unsigned</span> irq)
00348 {
00349     <span class="keywordflow">return</span> rt_release_irq(irq);
00350 }
00351 
00352 <span class="preprocessor">#ifdef __cplusplus</span>
00353 <span class="preprocessor"></span>}
00354 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00355 
00356 <span class="comment">/* include rtai_timer.h late (it might need something from above)</span>
00357 <span class="comment"> * it has to provide:</span>
00358 <span class="comment"> * - rtai_timer_irq_ack()</span>
00359 <span class="comment"> * - rtai_rdtsc()</span>
00360 <span class="comment"> * - void rt_set_timer_delay(int delay)</span>
00361 <span class="comment"> */</span>
00362 <span class="preprocessor">#include &lt;asm-arm/arch/rtai_timer.h&gt;</span>
00363 
00364 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00365 
00366 <span class="preprocessor">#include &lt;asm/rtai_oldnames.h&gt;</span>
00367 
00368 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_ASM_ARM_HAL_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Nov 17 12:29:17 2005 for RTAI API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
